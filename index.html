<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Central Lodge Boot</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 40px;
    background: #fafafa;
  }

  .wave-line {
    width: 85%;
    height: 3px;
    margin: 25px auto;
    background: linear-gradient(
      to right,
      rgba(0, 140, 255, 1),
      rgba(0, 200, 255, 0.6),
      rgba(0, 140, 255, 1)
    );
    animation: wavePulse 2s infinite ease-in-out;
    transform-origin: center;
    border-radius: 2px;
  }

  @keyframes wavePulse {
    0%   { transform: scaleY(0.25); opacity: 0.6; }
    50%  { transform: scaleY(1.0); opacity: 1.0; }
    100% { transform: scaleY(0.25); opacity: 0.6; }
  }

  .central-lodge {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
    max-width: 420px;
    margin: 30px auto;
  }

  .pax-slot {
    border: 1px solid #444;
    padding: 10px;
    border-radius: 6px;
    background: #fff;
  }

  .label {
    font-weight: bold;
  }

  .wave-rail {
    width: 100%;
    height: 3px;
    margin-top: 8px;
    background: linear-gradient(
      to right,
      rgba(0, 140, 255, 1),
      rgba(0, 200, 255, 0.6),
      rgba(0, 140, 255, 1)
    );
    animation: railPulse 1.8s infinite ease-in-out;
    transform-origin: center;
    border-radius: 2px;
  }

  @keyframes railPulse {
    0%   { transform: scaleY(0.25); opacity: 0.6; }
    50%  { transform: scaleY(1.0); opacity: 1.0; }
    100% { transform: scaleY(0.25); opacity: 0.6; }
  }
</style>
</head>

<body>

<div id="dynamic-heading"></div>

<div class="wave-line"></div>

<div id="central-lodge" class="central-lodge">
  <div class="pax-slot">
    <span class="label">PAX 1:</span> <span class="status" data-id="1">...</span>
    <div class="wave-rail"></div>
  </div>

  <div class="pax-slot">
    <span class="label">PAX 2:</span> <span class="status" data-id="2">...</span>
    <div class="wave-rail"></div>
  </div>

  <div class="pax-slot">
    <span class="label">PAX 3:</span> <span class="status" data-id="3">...</span>
    <div class="wave-rail"></div>
  </div>

  <div class="pax-slot">
    <span class="label">PAX 4:</span> <span class="status" data-id="4">...</span>
    <div class="wave-rail"></div>
  </div>
</div>

<script>
window.onload = function() {

  // Heading injection
  const link = document.createElement('a');
  link.href = 'https://www.hawaiicommunityfoundation.org/maui-strong';
  link.textContent = 'HAWAII HAWAII';

  const h1 = document.createElement('h1');
  h1.appendChild(link);
  document.getElementById('dynamic-heading').appendChild(h1);

  // AJAX Bender
  const statuses = document.querySelectorAll('.status');

  function ajaxBender(id, element) {
    fetch('/api/lock-sensor?id=' + id)
      .then(r => r.json())
      .then(data => {
        element.textContent = data.state + ' (E=' + data.E + ')';

        const rail = element.parentElement.querySelector('.wave-rail');
        if (rail) {
          rail.style.opacity = Math.min(1, 0.4 + (data.E / 100));
          rail.style.transform = `scaleY(${0.2 + (data.E / 200)})`;
        }
      })
      .catch(() => {
        element.textContent = 'COM ERROR';
      });
  }

  function updateAll() {
    statuses.forEach(span => {
      ajaxBender(span.dataset.id, span);
    });
  }

  updateAll();

  let count = 0;
  const limit = 100;

  const interval = setInterval(() => {
    if (count++ >= limit) {
      clearInterval(interval);
      return;
    }
    updateAll();
  }, 5000);
};
</script>

</body>
</html>
